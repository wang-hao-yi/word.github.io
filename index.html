<!DOCTYPE html>
<html>
	<head>
		<title>英文單字</title>
		<link rel="stylesheet" type="text/css" href="./word.css">
		<script src='./Assist.js'></script>
		<script>
		var currentScript = [];
		</script>
		<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-analytics.js"></script>
		<script>
		var firebaseConfig = {
			apiKey: "AIzaSyCscmddu_yfmDNZgTlnEu9H7beuUozMiPE",
			authDomain: "word-7ddc0.firebaseapp.com",
			databaseURL: "https://word-7ddc0-default-rtdb.firebaseio.com",
			projectId: "word-7ddc0",
			storageBucket: "word-7ddc0.appspot.com",
			messagingSenderId: "41425239359",
			appId: "1:41425239359:web:d23ab641a06b34502c278a",
			measurementId: "G-2V8Z2RZJCJ"
		  };
		firebase.initializeApp(firebaseConfig);
		firebase.analytics();
		const db = firebase.database();
		/*
		{
  "rules": {
    ".write":"auth.uid != null",
    ".read": true,
    "$user": {
      ".validate":"$user === auth.uid"
    }
  }
}
*/
		</script>
	</head>
	<body>
	<table id='Get'>
	<tr>
	<td>load...</td>
	</tr>
	</table>
	<div id='Set'>
	<object id='left'></object>
	<text class='check'>考英文(單選):</text><input type='number' class='check' id='SC1' min=0><br class='check'>
	<text class='check'>考中文(單選):</text><input type='number' class='check' id='SC2' min=0><br class='check'>
	<button class='check' onclick='SCF(document.getElementById("SC1").value,document.getElementById("SC2").value);'>單選確定</button><br class='check'>
	<text class='Ncheck'>題目數:</text><input type='number' class='Ncheck' id='SC' min=0><br class='Ncheck'>
	<button class='Ncheck' onclick='SCF(document.getElementById("SC").value,"0");'>單選確定</button><br class='Ncheck'>
	<input type='checkbox' id='SCcheck'>自動選取考英文還是考中文
	<table id='table'>
	<tbody>
	<script>
	currentScript['Set'] = document.currentScript;
	</script>
	</tbody>
	</table>
	</div>
	<script>
	ChangeF(['Set'],['Ncheck'])
	var set = [];
	var listnA = [];
	var listnB = [];
	var bodywidth = document.body.clientWidth;
	var bodyheight = document.body.clientHeight;
	var tablewidth = document.getElementById('table').clientWidth;
	var tableheight = document.getElementById('table').clientHeight;
	var check = 0;
	db.ref('set').once('value', function (snapshot){
		list = snapshot.val();
		GetF(0);
	});
	function GetF(getA){
		if(getA == 0){
			ChangeF(['Set','Get'],[]);
			textF();
			recoverF(0);
		}
	}
	function recoverF(get){
		if(get == 0){
			listnA = [];
		}
		listnB = [];
		for(var i=0;i<list.length;i++){
			if(get == 0){
				listnA[i] = 0;
			}
			listnB[i] = 0;
		}
	}
	function textF(){
		var i=0,j=0;
		while(i<list.length){
			var str='<tr>';
			while(j<list[i].length){
				for(k=0;k<list[i][j].length;k++){
					str+='<td>'+list[i][j][k]+'</td>'
				}
				j++;
			}
			str+='</tr>'
			CurrentScriptF('Set','bb',str);
			i++;
			j=0;
		}
	}
	function SCF(get1,get2){
		recoverF(0);
		var get = parseInt(get1,10)+parseInt(get2,10);
		if(get <= list.length){
			set = []
			for(i=0;i<get;i++){
				recoverF(1);
				var num1 = Math.floor(Math.random()*list.length);
				while(listnA[num1] == 1){
					var num1 = Math.floor(Math.random()*list.length);
				}
				var num2 = Math.floor(Math.random()*list[num1][0].length);
				var num3 = Math.floor(Math.random()*list[num1][1].length);
				if(check == 1){
					var num4 = Math.floor(Math.random()*2);
				}else if(i < parseInt(get1,10)){
					var num4 = 0;
				}else{
					var num4 = 1;
				}
				listnA[num1] = 1;
				listnB[num1] = 1;
				set[i] = [[num1,num2,num3,num4]]
				set[i][1] = [];
				for(j=1;j<=3;j++){
					testF(set[i][j-1][0]);
					var num1 = Math.floor(Math.random()*list.length);
					while(listnB[num1] == 1){
						var num1 = Math.floor(Math.random()*list.length);
					}
					var num2 = Math.floor(Math.random()*list[num1][0].length);
					var num3 = Math.floor(Math.random()*list[num1][1].length);
					listnB[num1] = 1;
					set[i][j] = [num1,num2,num3]
				}
			}
			console.log(set);
		}
	}
	function testF(get){
		for(k=0;k<list.length;k++){
			for(l=0;l<list[k].length;l++){
				for(m=0;m<list[k][l].length;m++){
					if(list[get][l].indexOf(list[k][l][m]) != -1){
						listnB[k] = 1
					}
				}
			}
		}
	}
	var AutoLoadF = setInterval(function(){
		bodywidth = document.body.clientWidth;
		bodyheight = document.body.scrollHeight;
		tablewidth = document.getElementById('table').clientWidth;
		tableheight = document.getElementById('table').scrollHeight;
		if(tablewidth != 0){
			var leftbody = (bodywidth - tablewidth)/2;
			if(leftbody > 0.5 && document.getElementById("left").style.display != 'none'){
			document.getElementById("left").setAttribute('width', leftbody);
			document.getElementById("left").setAttribute('heigth', bodyheight);
			}else if(leftbody > 0.5 && document.getElementById("left").style.display == 'none'){
				ChangeF(['left'],[])
			}else if(leftbody <= 0.5 && document.getElementById("left").style.display != 'none'){
				ChangeF(['left'],[])
			}
		}
		if(document.getElementById('SCcheck').checked == true && check == 0){
			ChangeF([],['check','Ncheck'])
			check++;
		}else if(document.getElementById('SCcheck').checked == false && check == 1){
			ChangeF([],['check','Ncheck'])
			check--;
		}
	},100);
	</script>
	</body>
</html>
