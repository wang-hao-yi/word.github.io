<!DOCTYPE html>
<html>
	<head>
		<title>英文單字</title>
		<link rel="stylesheet" type="text/css" href="./word.css">
		<script src='./Assist.js'></script>
		<script>
		var currentScript = [];
		</script>
		<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-analytics.js"></script>
		<script>
		var firebaseConfig = {
			apiKey: "AIzaSyCscmddu_yfmDNZgTlnEu9H7beuUozMiPE",
			authDomain: "word-7ddc0.firebaseapp.com",
			databaseURL: "https://word-7ddc0-default-rtdb.firebaseio.com",
			projectId: "word-7ddc0",
			storageBucket: "word-7ddc0.appspot.com",
			messagingSenderId: "41425239359",
			appId: "1:41425239359:web:d23ab641a06b34502c278a",
			measurementId: "G-2V8Z2RZJCJ"
		  };
		firebase.initializeApp(firebaseConfig);
		firebase.analytics();
		const db = firebase.database();
		/*
		{
  "rules": {
    ".write":"auth.uid != null",
    ".read": true,
    "$user": {
      ".validate":"$user === auth.uid"
    }
  }
}
*/
		</script>
	</head>
	<body>
	<table id='Get'>
	<tr>
	<td>load...</td>
	</tr>
	</table>
	<div id='Set'>
	<text onclick='fontset(--font);'>字體縮小</text>
	<text id='fontget'></text>
	<text onclick='fontset(++font);'>字體放大</text><br>
	<table id='table'>
	<tbody id='list'>
	<script>
	currentScript['Set'] = document.currentScript;
	</script>
	</tbody>
	</table>
	</div>
	<script>
	ChangeF(['Set'],[]);
	var list = [];
	var font = local('font',20);
	fontset(font);
	db.ref('3jHUIHawvkUo5R4bUvOw52c7YCK2').once('value', function (snapshot){
		ChangeF(['Set','Get'],[]);
	});
	db.ref('3jHUIHawvkUo5R4bUvOw52c7YCK2').on('value', function (snapshot){
		list = snapshot.val();
		textF();
	});
	function local(get,define){
		get = localStorage.getItem(get);
		if(get == null){
			return define;
		}else{
			return get;
		}
	}
	function textF(){
		if(NUF(document.getElementById('list'),[false,false],'and')){
			document.getElementById('list').innerText = ''
			CreateF('script',"currentScript['Set'] = document.currentScript;",'list')
		}
		var max = [0,0];
		for(var i=0;i<list.length;i++){
			for(var j=0;j<list[i].length;j++){
				if(list[i][j].length+1 > max[j]){
					max[j] = list[i][j].length+1;
				}
			}
		}
		for(var i=0;i<list.length;i++){
			var str='<tr>';
			for(var j=0;j<2;j++){
				for(k=0;k<list[i][j].length;k++){
					str+='<td onclick='+addTextF('add('+i+','+j+','+k+',event.srcElement)')+'>'+list[i][j][k]+'</td>'
				}
				str+='<td onclick='+addTextF('add('+i+','+j+','+k+',event.srcElement)')+'>+</td>'
				for(var k=max[j]-list[i][j].length-1;k>0;k--){
					str+='<td> </td>'
				}
			}
			str+='</tr>';
			CurrentScriptF('Set','bb',str);
		}
		var str='<tr>';
			for(var j=0;j<2;j++){
				str+='<td onclick='+addTextF('add('+i+','+j+','+0+',event.srcElement)')+'>+</td>'
				for(var k=max[j]-1;k>0;k--){
					str+='<td> </td>'
				}
			}
			str+='</tr>';
			CurrentScriptF('Set','bb',str);
	}
	function fontset(font){
		document.getElementById('Set').style.fontSize = font+'px'
		document.getElementById('fontget').innerText = font+'px'
		localStorage.setItem('font',font);
	}
	function add(i,j,k,e){
		console.log(i,j,k,e)
		if(NUF(list[i],[false,false],'and')){
			if(NUF(list[i][j],[false,false],'and')){
				if(NUF(list[i][j][k],[false,false],'and')){
					var set = prompt('請輸入該項(空白為不定義)',list[i][j][k]);
				}else{var set = prompt('請輸入該項(空白為不定義)');}
			}else{var set = prompt('請輸入該項(空白為不定義)');}
		}else{var set = prompt('請輸入該項(空白為不定義)');}
		if(set !== '' && set !== null){
			e.innerText = set;
			if(NUF(list[i],[true,true],'or')){
				list[i] = [];
			}
			if(NUF(list[i][j],[true,true],'or')){
				list[i][j] = [];
			}
			list[i][j][k] = set;
			db.ref('/3jHUIHawvkUo5R4bUvOw52c7YCK2').set(list);
		}
	}
	</script>
	</body>
</html>
